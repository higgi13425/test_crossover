<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>sim_datasets</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="sim_data_files/libs/clipboard/clipboard.min.js"></script>
<script src="sim_data_files/libs/quarto-html/quarto.js"></script>
<script src="sim_data_files/libs/quarto-html/popper.min.js"></script>
<script src="sim_data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sim_data_files/libs/quarto-html/anchor.min.js"></script>
<link href="sim_data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sim_data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sim_data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sim_data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sim_data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">sim_datasets</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="creating-simulated-datasets" class="level2">
<h2 class="anchored" data-anchor-id="creating-simulated-datasets">Creating simulated datasets</h2>
<p>We will simulate datasets for a planned clinical trial for fatigue in IBD in the absence of a flare, iron deficiency anemia, or hypothyroidism.</p>
<p>We will start with a test example from the CrossCarry package, the Arterial dataset.</p>
<p>Let’s read this in and examine it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>art <span class="ot">&lt;-</span> CrossCarry<span class="sc">::</span>Arterial </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>art<span class="sc">$</span>Subject <span class="sc">|&gt;</span> <span class="fu">table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2  3  4  5  6  7  8  9 10 11 12 
30 30 30 30 30 30 30 30 30 30 30 30 </code></pre>
</div>
</div>
<p>There are 12 subjects, and 10 time points (from -30 to 240 min) per subject per period, there are 3 periods, and three treatments (A,B,C). The outcome is Pressure = SBP in mm Hg. The 5 variables are subject, period, treatment, pressure, and time. The paper on the CrossCarry package is at <a href="https://arxiv.org/pdf/2304.02440" class="uri">https://arxiv.org/pdf/2304.02440</a>.</p>
<p>You can estimate the carryover with this code (from the paper).</p>
<p>This adds variables for Carry_B and Carry_C to the 2-item list <code>carryover</code>, which includes the (1) original dataset, to which has been added the new (1/0 indicator) variables Carry_B and Carry_C, and (2) the vector of carryover variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>carryover <span class="ot">&lt;-</span> <span class="fu">createCarry</span>(<span class="at">data=</span>Arterial, <span class="at">treatment =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">"Subject"</span>, <span class="at">period =</span> <span class="st">"Period"</span>, <span class="at">carrySimple =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This variable was added to data: Carry_B"
[2] "This variable was added to data: Carry_C"</code></pre>
</div>
</div>
<p>Then we can build the crossGEE model with the code below.</p>
<p>This results in a 2-item list named model, which contains (1) a QIC dataframe, and (2) a 28-item list of model components</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">CrossGEE</span>(<span class="at">response =</span> <span class="st">"Pressure"</span>, <span class="at">treatment =</span> <span class="st">"Treatment"</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="st">"Period"</span>, <span class="at">id=</span><span class="st">"Subject"</span>, <span class="at">carry=</span>carryover<span class="sc">$</span>carryover,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data=</span>carryover<span class="sc">$</span>data, <span class="at">correlation =</span> <span class="st">"exchangeable"</span>, <span class="at">family=</span><span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can view the QIC dataframe with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>QIC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          geepack..QIC.model1.
QIC                49010.57675
QICu               48982.50645
Quasi Lik         -24484.25322
CIC                   21.03515
params                 7.00000
QICC               49058.57675</code></pre>
</div>
</div>
<p>The output of the QIC is displayed, which is used to compare different models for the same variable. You can make a new model by adding the Time variable for minutes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">CrossGEE</span>(<span class="at">response =</span> <span class="st">"Pressure"</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treatment =</span> <span class="st">"Treatment"</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">period =</span> <span class="st">"Period"</span>, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id=</span><span class="st">"Subject"</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">carry=</span>carryover<span class="sc">$</span>carryover, </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>carryover<span class="sc">$</span>data, </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">correlation =</span> <span class="st">"exchangeable"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">covar =</span> <span class="st">"Time"</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family=</span><span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can view the QIC, which has changed in model 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model2<span class="sc">$</span>QIC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          geepack..QIC.model1.
QIC                48937.80269
QICu               48910.01738
Quasi Lik         -24447.00869
CIC                   21.89266
params                 8.00000
QICC               49027.80269</code></pre>
</div>
</div>
<p>In model 2, It is clearly observed that there is reduction in the QIC, QICu, Quasi Lik and QICC, but the CIC did increase.</p>
<p>You can also look at the model with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model2<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

Coefficients:
 (Intercept)      Period2      Period3   TreatmentB 
107.52940285   2.06062091   0.93562091   1.55792877 
  TreatmentC      Carry_B      Carry_C         Time 
 -6.26854969  -2.12621368  -3.10564906   0.00620324 

Degrees of Freedom: 360 Total (i.e. Null);  352 Residual

Scale Link:                   identity
Estimated Scale Parameters:  [1] 135.8167

Correlation:  Structure = exchangeable    Link = identity 
Estimated Correlation Parameters:
    alpha 
0.4985341 

Number of clusters:   12   Maximum cluster size: 30 </code></pre>
</div>
</div>
<p>and see the summary with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2<span class="sc">$</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

 Coefficients:
              Estimate    Std.err     Wald
(Intercept) 107.529403   3.186461 1138.773
Period2       2.060621   1.318963    2.441
Period3       0.935621   1.122435    0.695
TreatmentB    1.557929   1.780112    0.766
TreatmentC   -6.268550   1.663824   14.194
Carry_B      -2.126214   1.787201    1.415
Carry_C      -3.105649   2.178449    2.032
Time          0.006203   0.007540    0.677
                        Pr(&gt;|W|)    
(Intercept) &lt; 0.0000000000000002 ***
Period2                 0.118217    
Period3                 0.404527    
TreatmentB              0.381473    
TreatmentC              0.000165 ***
Carry_B                 0.234169    
Carry_C                 0.153977    
Time                    0.410669    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation structure = exchangeable 
Estimated Scale Parameters:

            Estimate Std.err
(Intercept)    135.8   23.16
  Link = identity 

Estimated Correlation Parameters:
      Estimate Std.err
alpha   0.4985  0.1114
Number of clusters:   12  Maximum cluster size: 30 </code></pre>
</div>
</div>
<p>Treatment C reduces BP by 6.3 mm Hg compared to treatment A, and is the only significant predictor. None of the Periods, carryover vars, nor Treatment B are significantly associated with pressure.</p>
<section id="test-a-simple-trial" class="level3">
<h3 class="anchored" data-anchor-id="test-a-simple-trial">Test a Simple Trial</h3>
<p>We will use a simple approach with 2 treatments, thiamine at 15 mg/kg daily, and modafinil 100 mg bid, with 4 week treatment periods and 4 week washout periods. Fatigue and QoL will be measured at the beginning and end of each period with the appropriate PRO (UCPRO and CDPRO), and with the fatigue instrument, the Inflammatory Bowel Disease-Fatigue Questionnaire. Range is 0-20 from 5 questions to get score 1, with higher scores indicating more fatigue.</p>
<p>There will be 5 study periods, 2 drugs. All will be of 4 weeks duration.</p>
<table class="table">
<thead>
<tr class="header">
<th>Sequence</th>
<th>Period 1</th>
<th>Period 2</th>
<th>Period 3</th>
<th>Period 4</th>
<th>Period 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 - AAB</td>
<td>Thi</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Mod</td>
</tr>
<tr class="even">
<td>2 - ABA</td>
<td>Thi</td>
<td>Washout</td>
<td>Mod</td>
<td>Washout</td>
<td>Thi</td>
</tr>
<tr class="odd">
<td>3 - BAA</td>
<td>Mod</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Thi</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 period, 2 drug, 6 seq no carryover, 6 fatigue measurements</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">=</span> <span class="dv">15</span> <span class="co"># 0 to 20 scale</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>sdev <span class="ot">=</span> <span class="fl">1.5</span> <span class="co"># used mean and SD data (3.5) for fatigue from Bager paper and Moulton paper</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">=</span> <span class="dv">0</span> <span class="co"># half of previous effect size</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">=</span> <span class="dv">0</span> <span class="co"># one quarter of 2nd previous effect size </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>effect_t <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.7</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>effect_m <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">9.3</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># expect thiamine to be about 5.6 points worse</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>data1sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up patient_id</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up f scores as single col, </span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up time point as measurement time 1-8</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total 240 measurements of fatigue (f)</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seq =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">each =</span> <span class="dv">6</span>), <span class="dv">10</span>),</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">timepoint =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">times =</span> <span class="dv">30</span>)),</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random noise</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand2 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand3 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand4 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand5 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand6 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">c1 =</span> <span class="dv">0</span>,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">c2 =</span> <span class="dv">0</span>,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> baseline,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="fu">case_when</span>(timepoint <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_t,</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_t,</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_m,</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_t,</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_m,</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_t,</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> effect_m,</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> effect_t,</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> effect_t),</span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">fatigue =</span> <span class="fu">round</span>(baseline <span class="sc">+</span> effect <span class="sc">+</span> c1 <span class="sc">+</span> c2 <span class="sc">+</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">case_when</span>(timepoint <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> rand1,</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> rand2,</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> rand3,</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> rand4,</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> rand5,</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> rand6</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>              ))</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a>data2sim <span class="ot">&lt;-</span> data1sim <span class="sc">|&gt;</span> </span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, timepoint, seq, fatigue) <span class="sc">|&gt;</span> </span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(subject_id, seq), <span class="at">names_from =</span> timepoint, <span class="at">names_prefix =</span> <span class="st">"tmpt_"</span>, <span class="at">values_from =</span> fatigue)</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>data2sim_long <span class="ot">&lt;-</span> data2sim <span class="sc">|&gt;</span> </span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> tmpt_1<span class="sc">:</span>tmpt_6,<span class="at">names_prefix =</span> <span class="st">"tmpt_"</span>, <span class="at">names_to =</span> <span class="st">"timepoint"</span>, <span class="at">values_to =</span> <span class="st">"fatigue"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timepoint =</span> <span class="fu">as.numeric</span>(timepoint)) <span class="sc">|&gt;</span> </span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> (timepoint <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">2</span> ) <span class="sc">|&gt;</span> </span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">90</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rx =</span> <span class="fu">case_when</span>(seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Thi"</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a>                        ))  <span class="sc">|&gt;</span> </span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fatigue =</span> <span class="fu">case_when</span>(fatigue <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a>                             fatigue <span class="sc">&gt;</span><span class="dv">20</span> <span class="sc">~</span> <span class="dv">20</span>,</span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> fatigue )) <span class="sc">|&gt;</span> </span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">&lt;</span> <span class="dv">4</span>) </span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define c1, c2 depending on seq and period</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This adds variables for Carry_Thi and Carry_Well to the 2-item list <code>carryover</code>, which includes the (1) original dataset, to which has been added the new (1/0 indicator) variables Carry_Thi and Carry_Well, and (2) the vector of carryover variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>carryover_sim <span class="ot">&lt;-</span> <span class="fu">createCarry</span>(<span class="at">data =</span> data2sim_long, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">treatment =</span> <span class="st">"rx"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> <span class="st">"subject_id"</span>, </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">period =</span> <span class="st">"period"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">carrySimple =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This variable was added to data: Carry_Thi"</code></pre>
</div>
</div>
<p>Then we can build the crossGEE model with the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>model4_sim <span class="ot">&lt;-</span> <span class="fu">CrossGEE</span>(<span class="at">response =</span> <span class="st">"fatigue"</span>, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treatment =</span> <span class="st">"rx"</span>, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">period =</span> <span class="st">"period"</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> <span class="st">"subject_id"</span>, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">carry =</span> carryover_sim<span class="sc">$</span>carryover, </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> carryover_sim<span class="sc">$</span>data, </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">correlation =</span> <span class="st">"exchangeable"</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">covar =</span> <span class="st">"time"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and review the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model4_sim<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

Coefficients:
(Intercept)     period2     period3       rxThi   Carry_Thi 
    12.9094      0.2450      0.3450      2.9025     -0.2425 
       time 
    -5.6889 

Degrees of Freedom: 180 Total (i.e. Null);  174 Residual

Scale Link:                   identity
Estimated Scale Parameters:  [1] 4.115

Correlation:  Structure = exchangeable    Link = identity 
Estimated Correlation Parameters:
   alpha 
-0.09507 

Number of clusters:   30   Maximum cluster size: 6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4_sim<span class="sc">$</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

 Coefficients:
            Estimate Std.err    Wald            Pr(&gt;|W|)
(Intercept)   12.909   0.303 1812.03 &lt;0.0000000000000002
period2        0.245   0.394    0.39                0.53
period3        0.345   0.418    0.68                0.41
rxThi          2.903   0.244  141.43 &lt;0.0000000000000002
Carry_Thi     -0.242   0.350    0.48                0.49
time          -5.689   0.203  785.18 &lt;0.0000000000000002
               
(Intercept) ***
period2        
period3        
rxThi       ***
Carry_Thi      
time        ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation structure = exchangeable 
Estimated Scale Parameters:

            Estimate Std.err
(Intercept)     4.11   0.496
  Link = identity 

Estimated Correlation Parameters:
      Estimate Std.err
alpha  -0.0951  0.0271
Number of clusters:   30  Maximum cluster size: 6 </code></pre>
</div>
</div>
</section>
<section id="test-a-more-complex-3-drug-trial" class="level3">
<h3 class="anchored" data-anchor-id="test-a-more-complex-3-drug-trial">Test a More Complex 3 drug Trial</h3>
<p>We will step up to 3 treatments, thiamine at 15 mg/kg daily, modafinil 100 mg bid, and wellbutrin with 8 week treatment periods and 4 week washout periods. Fatigue and QoL will be measured at the beginning and end of each period with the appropriate PRO (UCPRO and CDPRO), and with the fatigue instrument, the Inflammatory Bowel Disease-Fatigue Questionnaire. Range is 0-20 from 5 questions to get score 1, with higher scores indicating more fatigue.</p>
<p>There will be 5 study periods and six sequences.</p>
<table class="table">
<thead>
<tr class="header">
<th>Sequence</th>
<th>Period 1</th>
<th>Period 2</th>
<th>Period 3</th>
<th>Period 4</th>
<th>Period 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 - ABC</td>
<td>Thi</td>
<td>Washout</td>
<td>Mod</td>
<td>Washout</td>
<td>Well</td>
</tr>
<tr class="even">
<td>2 - ACB</td>
<td>Thi</td>
<td>Washout</td>
<td>Well</td>
<td>Washout</td>
<td>Mod</td>
</tr>
<tr class="odd">
<td>3 - BCA</td>
<td>Mod</td>
<td>Washout</td>
<td>Well</td>
<td>Washout</td>
<td>Thi</td>
</tr>
<tr class="even">
<td>1 - BAC</td>
<td>Mod</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Well</td>
</tr>
<tr class="odd">
<td>2 - CAB</td>
<td>Well</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Mod</td>
</tr>
<tr class="even">
<td>3 - CBA</td>
<td>Well</td>
<td>Washout</td>
<td>Mod</td>
<td>Washout</td>
<td>Thi</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5 period, 3 drug, 6 seq no carryover, 6 fatigue measurements</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">=</span> <span class="dv">15</span> <span class="co"># 0 to 20 scale</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sdev <span class="ot">=</span> <span class="fl">3.5</span> <span class="co"># used mean and SD data for fatigue from Bager paper and Moulton paper</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">=</span> <span class="dv">0</span> <span class="co"># half of previous effect size</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">=</span> <span class="dv">0</span> <span class="co"># one quarter of 2nd previous effect size </span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>effect_t <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">3.7</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>effect_m <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">9.3</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>effect_w <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">7</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># expect thiamine to be about 5.6 points worse</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>data1_3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up patient_id</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up f scores as single col, </span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up time point as measurement time 1-6</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total 180 measurements of fatigue (f)</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> <span class="dv">6</span>),</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seq =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>), <span class="at">each =</span> <span class="dv">5</span>), <span class="dv">6</span>),</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">timepoint =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">times =</span> <span class="dv">30</span>)),</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random noise</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand2 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand3 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand4 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand5 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand6 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">180</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">c1 =</span> <span class="dv">0</span>,</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">c2 =</span> <span class="dv">0</span>,</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> baseline,</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="fu">case_when</span>(timepoint <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_t,</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_t,</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> effect_t,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_w,</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_m,</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> effect_t),</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">fatigue =</span> <span class="fu">round</span>(baseline <span class="sc">+</span> effect <span class="sc">+</span> c1 <span class="sc">+</span> c2 <span class="sc">+</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">case_when</span>(timepoint <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> rand1,</span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> rand2,</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> rand3,</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> rand4,</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> rand5,</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> rand6</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>              ))</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>data2_3 <span class="ot">&lt;-</span> data1_3 <span class="sc">|&gt;</span> </span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, timepoint, seq, fatigue) <span class="sc">|&gt;</span> </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(subject_id, seq), <span class="at">names_from =</span> timepoint, <span class="at">names_prefix =</span> <span class="st">"tmpt_"</span>, <span class="at">values_from =</span> fatigue)</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>data2_3_long <span class="ot">&lt;-</span> data2_3 <span class="sc">|&gt;</span> </span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> tmpt_1<span class="sc">:</span>tmpt_6,<span class="at">names_prefix =</span> <span class="st">"tmpt_"</span>, <span class="at">names_to =</span> <span class="st">"timepoint"</span>, <span class="at">values_to =</span> <span class="st">"fatigue"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timepoint =</span> <span class="fu">as.numeric</span>(timepoint)) <span class="sc">|&gt;</span> </span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> (timepoint <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">2</span> ) <span class="sc">|&gt;</span> </span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">180</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rx =</span> <span class="fu">case_when</span>(seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Well"</span>,</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Well"</span>,</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Well"</span>,</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">4</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Well"</span>,</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Well"</span>,</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">5</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Well"</span>,</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">6</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Thi"</span></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>                        ))  <span class="sc">|&gt;</span> </span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fatigue =</span> <span class="fu">case_when</span>(fatigue <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>                             fatigue <span class="sc">&gt;</span><span class="dv">20</span> <span class="sc">~</span> <span class="dv">20</span>,</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>                              <span class="cn">TRUE</span> <span class="sc">~</span> fatigue )) <span class="sc">|&gt;</span> </span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">&lt;</span> <span class="dv">4</span>) </span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define c1, c2 depending on seq and period</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates 3 data sets with a 1st order carryover of 0, and a 2nd order carryover of 0.</p>
<p>data1 is tall, with all of the input vars, including random noise at each time point.</p>
<p>data2 is wide, with only subject_id, sequence, and fatigue score at each time point.</p>
<p>data2_long is the same as data2 but in long format.</p>
<p>Adeed period, time, treatment, to get the data formatted for CrossCarry</p>
<p>Let’s try to code this one.</p>
<p>First we will add the indicator (1/0) variables for carryover.</p>
<p>You can estimate the carryover with this code (from the paper).</p>
<p>This adds variables for Carry_Thi and Carry_Well to the 2-item list <code>carryover</code>, which includes the (1) original dataset, to which has been added the new (1/0 indicator) variables Carry_Thi and Carry_Well, and (2) the vector of carryover variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>carryover_3 <span class="ot">&lt;-</span> <span class="fu">createCarry</span>(<span class="at">data =</span> data2_3_long, </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">treatment =</span> <span class="st">"rx"</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">id =</span> <span class="st">"subject_id"</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">period =</span> <span class="st">"period"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">carrySimple =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This variable was added to data: Carry_Thi" 
[2] "This variable was added to data: Carry_Well"</code></pre>
</div>
</div>
<p>Then we can build the crossGEE model with the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model4_3 <span class="ot">&lt;-</span> <span class="fu">CrossGEE</span>(<span class="at">response =</span> <span class="st">"fatigue"</span>, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treatment =</span> <span class="st">"rx"</span>, </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">period =</span> <span class="st">"period"</span>, </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> <span class="st">"subject_id"</span>, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">carry =</span> carryover_3<span class="sc">$</span>carryover, </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> carryover_3<span class="sc">$</span>data, </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">correlation =</span> <span class="st">"exchangeable"</span>, </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">covar =</span> <span class="st">"time"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and review the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>model4_3<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

Coefficients:
(Intercept)     period2     period3       rxThi      rxWell 
  13.617217    0.400799    0.267219    1.269174    0.073465 
  Carry_Thi  Carry_Well        time 
  -0.453440    0.000739   -6.945826 

Degrees of Freedom: 162 Total (i.e. Null);  154 Residual

Scale Link:                   identity
Estimated Scale Parameters:  [1] 11.5

Correlation:  Structure = exchangeable    Link = identity 
Estimated Correlation Parameters:
alpha 
 0.11 

Number of clusters:   30   Maximum cluster size: 6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4_3<span class="sc">$</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

 Coefficients:
             Estimate   Std.err   Wald            Pr(&gt;|W|)
(Intercept) 13.617217  0.576881 557.19 &lt;0.0000000000000002
period2      0.400799  0.696917   0.33               0.565
period3      0.267219  0.798755   0.11               0.738
rxThi        1.269174  0.609954   4.33               0.037
rxWell       0.073465  0.647498   0.01               0.910
Carry_Thi   -0.453440  0.656221   0.48               0.490
Carry_Well   0.000739  0.763355   0.00               0.999
time        -6.945826  0.573377 146.75 &lt;0.0000000000000002
               
(Intercept) ***
period2        
period3        
rxThi       *  
rxWell         
Carry_Thi      
Carry_Well     
time        ***
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation structure = exchangeable 
Estimated Scale Parameters:

            Estimate Std.err
(Intercept)     11.5    1.07
  Link = identity 

Estimated Correlation Parameters:
      Estimate Std.err
alpha     0.11  0.0688
Number of clusters:   30  Maximum cluster size: 6 </code></pre>
</div>
</div>
</section>
<section id="our-proposed-trial" class="level3">
<h3 class="anchored" data-anchor-id="our-proposed-trial">Our Proposed Trial</h3>
<p>The trial design includes a crossover design between two treatments, thiamine at 15 mg/kg daily, and modafinil 100 mg bid, with 4 week treatment periods and 4 week washout periods. This will be followed by a 2nd 4 week washout period, then an 8 week trial of wellbutrin.</p>
<p>Fatigue and QoL will be measured at the beginning and end of each period with the appropriate PRO (UCPRO and CDPRO), and with the fatigue instrument, the Inflammatory Bowel Disease-Fatigue Questionnaire. Range is 0-20 from 5 questions to get score 1, with higher scores indicating more fatigue. The median for CD is 9 in remission, 11 in flare. The median for UC is 8 in remission, 11 in flare. Data from <em>Journal of Crohn’s and Colitis</em>, Volume 8, Issue 11, 1 November 2014, Pages 1398–1406, <a href="https://doi.org/10.1016/j.crohns.2014.04.013" class="uri">https://doi.org/10.1016/j.crohns.2014.04.013</a>. Improvement is considered a reduction by 3 points.</p>
<p>Questions for Score 1 include</p>
<p>1.1. What is your fatigue level right now</p>
<p>1.2. What was your highest fatigue level in the past 2 weeks</p>
<p>1.3. What was your lowest fatigue level in the past 2 weeks</p>
<p>1.4. What was your average fatigue level in the past 2 weeks</p>
<p>1.5. How much of your waking time have you felt fatigued in the past two weeks</p>
<p>Responses on a 0 (none) to 4 (severe or all of the time) scale - [these are guesses - need to see legit version of IBD-F]</p>
<p>0 None, 1 Slight, 2 Somewhat, 3 Moderate, 4 Severe</p>
<p>0 Never, 1 Rarely, 2 Sometimes, 3 Very Often, 4 All of the Time</p>
<p>We will consider 1st order and 2nd order carryover.</p>
<p>There will be 7 study periods. The first six will all be of 4 weeks duration. The last will be of 8 weeks duration (wellbutrin Rx).</p>
<table class="table">
<caption>Study Timeline</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Sequence</th>
<th>Period 1</th>
<th>Period 2</th>
<th>Period 3</th>
<th>Period 4</th>
<th>Period 5</th>
<th>Period 6</th>
<th>Period 7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1 - AAB</td>
<td>Thi</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Mod</td>
<td>Washout</td>
<td>Wellbutrin</td>
</tr>
<tr class="even">
<td>2 - ABA</td>
<td>Thi</td>
<td>Washout</td>
<td>Mod</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Wellbutrin</td>
</tr>
<tr class="odd">
<td>3 - BAA</td>
<td>Mod</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Thi</td>
<td>Washout</td>
<td>Wellbutrin</td>
</tr>
</tbody>
</table>
<p>Now to begin simulating a dataset of fatigue measurements (8 total).</p>
<p>All measurements will occur at the beginning and end of each period</p>
<p>We will start with 10 patients in each group, and a dataset with no carryover at all.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">=</span> <span class="dv">9</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sdev <span class="ot">=</span> <span class="dv">2</span> <span class="co">#get mean and SD data for fatigue from Bager paper</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">=</span> <span class="dv">0</span> <span class="co"># half of previous effect size</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">=</span> <span class="dv">0</span> <span class="co"># one quarter of 2nd previous effect size </span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_T = -3</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_M = -4</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># effect_W = -5</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up patient_id</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up f scores as single col, </span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set up time point as measurement time 1-8</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># total 240 measurements of fatigue (f)</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, <span class="at">each =</span> <span class="dv">8</span>),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seq =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">each =</span> <span class="dv">8</span>), <span class="dv">10</span>),</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">timepoint =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">times =</span> <span class="dv">30</span>)),</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add random noise</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand2 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand3 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand4 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand5 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand6 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand7 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">rand8 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">240</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sdev),</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">c1 =</span> <span class="dv">0</span>,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">c2 =</span> <span class="dv">0</span>,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline =</span> <span class="dv">9</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">effect =</span> <span class="fu">case_when</span>(timepoint <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">4</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">4</span>,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">4</span>,</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>                     seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">3</span>,</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="dv">0</span>, </span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>                     timepoint <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="sc">-</span><span class="dv">5</span>),</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">fatigue =</span> <span class="fu">round</span>(baseline <span class="sc">+</span> effect <span class="sc">+</span> c1 <span class="sc">+</span> c2 <span class="sc">+</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">case_when</span>(timepoint <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> rand1,</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> rand2,</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> rand3,</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> rand4,</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> rand5,</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> rand6,</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> rand7,</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>              timepoint <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> rand8</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>              ))</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> data1 <span class="sc">|&gt;</span> </span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, timepoint, seq, fatigue) <span class="sc">|&gt;</span> </span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(subject_id, seq), <span class="at">names_from =</span> timepoint, <span class="at">names_prefix =</span> <span class="st">"tmpt_"</span>, <span class="at">values_from =</span> fatigue)</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>data2_long <span class="ot">&lt;-</span> data2 <span class="sc">|&gt;</span> </span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> tmpt_1<span class="sc">:</span>tmpt_8,<span class="at">names_prefix =</span> <span class="st">"tmpt_"</span>, <span class="at">names_to =</span> <span class="st">"timepoint"</span>, <span class="at">values_to =</span> <span class="st">"fatigue"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timepoint =</span> <span class="fu">as.numeric</span>(timepoint)) <span class="sc">|&gt;</span> </span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">period =</span> (timepoint <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">2</span> ) <span class="sc">|&gt;</span> </span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dv">120</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rx =</span> <span class="fu">case_when</span>(seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">"Mod"</span>,</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">"Thi"</span>,</span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>                        seq <span class="sc">==</span> <span class="dv">3</span> <span class="sc">&amp;</span> period <span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">"Thi"</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>                        )) <span class="sc">|&gt;</span> </span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(period <span class="sc">&lt;</span> <span class="dv">4</span>) </span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define c1 depending on seq and period</span></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define c2 depending on seq and period</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This creates 3 data sets with a 1st order carryover of 0, and a 2nd order carryover of 0.</p>
<p>data1 is tall, with all of the input vars, including random noise at each time point.</p>
<p>data2 is wide, with only subject_id, sequence, and fatigue score at each time point.</p>
<p>data2_long is the same as data2 but in long format.</p>
<p>Adeed period, time, treatment, to get the data formatted for CrossCarry</p>
<p>Let’s try to code this one.</p>
<p>First we will add the indicator (1/0) variables for carryover.</p>
<p>You can estimate the carryover with this code (from the paper).</p>
<p>This adds variables for Carry_Thi and Carry_Well to the 2-item list <code>carryover</code>, which includes the (1) original dataset, to which has been added the new (1/0 indicator) variables Carry_Thi and Carry_Well, and (2) the vector of carryover variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>carryover <span class="ot">&lt;-</span> <span class="fu">createCarry</span>(<span class="at">data =</span> data2_long, <span class="at">treatment =</span> <span class="st">"rx"</span>,</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="st">"subject_id"</span>, <span class="at">period =</span> <span class="st">"period"</span>, <span class="at">carrySimple =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This variable was added to data: Carry_Thi"</code></pre>
</div>
</div>
<p>Then we can build the crossGEE model with the code below.</p>
<p>This results in a 2-item list named model, which contains (1) a QIC dataframe, and (2) a 28-item list of model components. Error - <code>Error in geepack::geeglm(formula = form1, family = family, corstr = correlation, : Model matrix is rank deficient; geeglm can not proceed</code></p>
<p>Per SO ( link: <a href="https://stackoverflow.com/questions/18818964/adding-interaction-to-gee-model-matrix-is-rank-deficient" class="uri">https://stackoverflow.com/questions/18818964/adding-interaction-to-gee-model-matrix-is-rank-deficient</a>), this can occur when you have a covariate that is constant across the dataset. May need to remove variables that are constant.</p>
<ul>
<li><p>Tried removing seq, timepoint to no effect.</p></li>
<li><p>Tried removing time after filtering to timepoint == 1</p></li>
<li><p>Tried reordering carry vars by changing “Well” to “aWell” since these are alphabetical by default</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">CrossGEE</span>(<span class="at">response =</span> <span class="st">"fatigue"</span>, </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treatment =</span> <span class="st">"rx"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">period =</span> <span class="st">"period"</span>, </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">id =</span> <span class="st">"subject_id"</span>, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">carry =</span> carryover<span class="sc">$</span>carryover,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> carryover<span class="sc">$</span>data, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">correlation =</span> <span class="st">"exchangeable"</span>, </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can view the QIC dataframe with - <code>did not work after model failure</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>model3<span class="sc">$</span>QIC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          geepack..QIC.model1.
QIC                    1137.06
QICu                   1141.76
Quasi Lik              -565.88
CIC                       2.65
params                    5.00
QICC                   1140.72</code></pre>
</div>
</div>
<p>The output of the QIC is displayed, which is used to compare different models for the same variable.</p>
<p>You can make a new model4 by adding the Time variable for minutes. Does not work after removing the time variable. Take time out of model - get Same error - <code>Error in geepack::geeglm(formula = form1, family = family, corstr = correlation,  :    Model matrix is rank deficient; geeglm can not proceed</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">&lt;-</span> <span class="fu">CrossGEE</span>(<span class="at">response =</span> <span class="st">"fatigue"</span>, <span class="at">treatment =</span> <span class="st">"rx"</span>, <span class="at">period =</span> <span class="st">"period"</span>, <span class="at">id=</span><span class="st">"subject_id"</span>, <span class="at">carry=</span>carryover<span class="sc">$</span>carryover, <span class="at">data=</span>carryover<span class="sc">$</span>data, <span class="at">correlation =</span> <span class="st">"exchangeable"</span>, <span class="at">family=</span><span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can view the QIC, which has changed in model 4. - <code>did not work after model failure</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>model4<span class="sc">$</span>QIC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          geepack..QIC.model1.
QIC                    1137.06
QICu                   1141.76
Quasi Lik              -565.88
CIC                       2.65
params                    5.00
QICC                   1140.72</code></pre>
</div>
</div>
<p>In model 4, It is clearly observed that there is reduction in the QIC, QICu, Quasi Lik and QICC, but the CIC did increase.</p>
<p>You can also look at the model with - <code>did not work after model failure</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>model4<span class="sc">$</span>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

Coefficients:
(Intercept)     period2     period3       rxThi   Carry_Thi 
      6.277       0.447       1.014       0.335       0.029 

Degrees of Freedom: 180 Total (i.e. Null);  175 Residual

Scale Link:                   identity
Estimated Scale Parameters:  [1] 6.29

Correlation:  Structure = exchangeable    Link = identity 
Estimated Correlation Parameters:
  alpha 
-0.0751 

Number of clusters:   30   Maximum cluster size: 6 </code></pre>
</div>
</div>
<p>and see the summary with - <code>did not work after model failure</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4<span class="sc">$</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
geepack::geeglm(formula = form1, family = family, data = data, 
    id = id, corstr = correlation)

 Coefficients:
            Estimate Std.err   Wald            Pr(&gt;|W|)    
(Intercept)    6.277   0.344 333.96 &lt;0.0000000000000002 ***
period2        0.447   0.474   0.89               0.345    
period3        1.014   0.376   7.27               0.007 ** 
rxThi          0.335   0.293   1.31               0.253    
Carry_Thi      0.029   0.379   0.01               0.939    
---
Signif. codes:  
0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation structure = exchangeable 
Estimated Scale Parameters:

            Estimate Std.err
(Intercept)     6.29   0.523
  Link = identity 

Estimated Correlation Parameters:
      Estimate Std.err
alpha  -0.0751  0.0312
Number of clusters:   30  Maximum cluster size: 6 </code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>